<!DOCTYPE html>
<html lang='en'>

<head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/marked/15.0.12/marked.min.js'></script>
	<title>MEMOS-WORKER</title>
	<script src='https://unpkg.com/turndown@7.2.1/dist/turndown.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js'></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap">
	<link id='hljs-light-theme' rel='stylesheet'
		href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css'>
	<link id='hljs-dark-theme' rel='stylesheet'
		href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css' disabled>
	<link rel='icon' type='image/png' href='/favicon.png'>
	<link rel="stylesheet" href="/styles/app.css">
</head>

<body class='loading' data-theme='dark'>
	<div id='initial-loader'>
		<div class='spinner'></div>
	</div>
	<div id='language-switcher'>
		<select id='language-select' aria-label='Language'>
			<option value='en'>English</option>
			<option value='zh'>ÁÆÄ‰Ωì‰∏≠Êñá</option>
			<option value='system'>Follow system</option>
		</select>
	</div>
	<!-- Login Screen -->
	<div id='auth-container'>
		<form id='login-form' class='auth-form'>
			<h3>MEMOS</h3>
			<div id='login-error'></div>
			<input type='text' id='username' placeholder='Username' required>
			<input type='password' id='password' placeholder='Password' required>
			<button type='submit' id='login-btn'>Login</button>
		</form>
	</div>
	<!-- ‰∏Ä‰∏™ÂåÖË£π‰∏âÊ†èÁöÑÂÆπÂô® -->
	<div id='app-layout-container'>

		<!-- Â∑¶‰æßÊ†è -->
		<aside id='left-sidebar'>
			<!-- --- ÂÖ®Â±ÄÊêúÁ¥¢Ê°Ü --- -->
			<div class='sidebar-search-container'>
				<svg class='search-icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
					<path
						d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'>
					</path>
				</svg>
				<input type='search' id='global-search-input' placeholder='Search...'>
				<button id='clear-search-btn' class='icon-btn' style='display: none;' title='Clear'>
					<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
						<path
							d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'>
						</path>
					</svg>
				</button>
			</div>

			<!-- --- ÁªüËÆ°Âç°Áâá --- -->
			<div id='stats-card' class='sidebar-content'>
				<div class='stat-item'>
					<span id='stats-days' class='stat-value'>--</span>
					<span class='stat-label'>Days</span>
				</div>
				<div class='stat-item'>
					<span id='stats-memos' class='stat-value'>--</span>
					<span class='stat-label'>Memos</span>
				</div>
				<div class='stat-item'>
					<span id='stats-tags' class='stat-value'>--</span>
					<span class='stat-label'>Tags</span>
				</div>
			</div>

			<div id='calendar-wrapper' class='sidebar-content'>
			</div>
			<div id='heatmap-container-wrapper' class='sidebar-content'>
				<div class='spinner'></div>
			</div>

			<div class='sidebar-content' id='tags-section-wrapper'>
				<h4>
					<span>Tags</span>
					<div class='sidebar-header-actions'>
						<button id='clear-tags-filter-btn' class='icon-btn' title='Clear tag filter'></button>
						<button class='sidebar-toggle-btn' data-target='tags-container'>
							<svg class='toggle-icon' xmlns='http://www.w3.org/2000/svg' height='24px'
								viewBox='0 0 24 24' width='24px' fill='currentColor'>
								<path d='M0 0h24v24H0V0z' fill='none' />
								<path d='M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z' />
							</svg>
						</button>
					</div>
				</h4>
				<div id='tags-container' class='sidebar-collapsible-content'>
					<div class='spinner'></div>
				</div>
			</div>

			<div class='sidebar-content' id='timeline-section-wrapper'>
				<h4>
					<span>Timeline</span>
					<div class='sidebar-header-actions'>
						<button id='clear-filter-btn' class='icon-btn' title='Show All Notes'></button>
						<button class='sidebar-toggle-btn' data-target='timeline-container'>
							<svg class='toggle-icon' xmlns='http://www.w3.org/2000/svg' height='24px'
								viewBox='0 0 24 24' width='24px' fill='currentColor'>
								<path d='M0 0h24v24H0V0z' fill='none' />
								<path d='M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z' />
							</svg>
						</button>
					</div>
				</h4>
				<div id='timeline-container' class='sidebar-collapsible-content'>
					<div class='spinner'></div>
				</div>
			</div>
		</aside>

		<!-- ‰∏≠Èó¥‰∏ªÂÜÖÂÆπÂå∫ -->
		<main id='main-content-area'>
			<div class='container'>
				<div id='app-container'>
					<header class='app-header'>
						<h3 id='header-title'>MEMOS</h3>
						<div class='header-actions'>
							<button type='button' id='refresh-btn' class='icon-btn' title='Refresh'>
								<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
									<path
										d='M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z'>
									</path>
								</svg>
							</button>
							<button id='waterfall-toggle-btn' class='icon-btn' title='Toggle waterfall mode'>
								<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px'
									fill='currentColor'>
									<path d='M0 0h24v24H0V0z' fill='none' />
									<path d='M10 18h5V5h-5v13zm-6 0h5V5H4v13zM16 5v13h5V5h-5z' />
								</svg>
							</button>
							<button id='wide-mode-toggle-btn' class='icon-btn' title='Toggle wide mode'>
								<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
									<path
										d='M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z'>
									</path>
								</svg>
							</button>

							<div id='more-actions-container' class='more-actions-container'>
								<button id='more-actions-btn' class='icon-btn' title='More options'>
									<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24'
										width='24px' fill='currentColor'>
										<path d='M0 0h24v24H0V0z' fill='none' />
										<path
											d='M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z' />
									</svg>
								</button>

								<div id='more-menu-popover' class='more-menu-popover'>
									<button id='settings-btn' class='more-menu-item'>
										<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24'
											width='24px' fill='currentColor'>
											<path d='M0 0h24v24H0V0z' fill='none' />
											<path
												d='M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.09-.7-1.71-.98L14.82 2.8c-.05-.23-.26-.4-.5-.4h-4c-.25 0-.46.17-.5.4L9.19 5.3c-.62.27-1.19.58-1.71.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.09.7 1.71.98l.37 2.66c.05.23.26.4.5.4h4c.25 0 .46-.17-.5-.4l.37-2.66c.62-.28 1.19-.58 1.71-.98l2.49 1c.22.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z' />
										</svg>
										<span>Settings</span>
									</button>
									<button id='theme-toggle-btn' class='more-menu-item'></button>

									<button id='theme-color-btn' class='more-menu-item'>
										<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24'
											width='24px' fill='currentColor'>
											<path d='M0 0h24v24H0V0z' fill='none' />
											<path
												d='M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z' />
										</svg>
										<span>Theme Color</span>
									</button>
									<button id='logout-btn' class='more-menu-item'>
										<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
											<path
												d='M16 17v-3H9v-2h7V9l4 4-4 4zm-5-3h-1v-2h1v2zm-2 3h-1v-2h1v2zm-7-11v16h14v-2H4V4h10V2H2v16z'>
											</path>
										</svg>
										<span>Logout</span>
									</button>
								</div>
							</div>
						</div>
					</header>

					<form id='note-form'>
						<div id='main-editor-container'>
							<textarea id='note-input' placeholder='Write in Markdown...' rows='3'></textarea>
							<div id='main-edit-preview' class='edit-preview note-content'></div>
						</div>

						<div class='form-actions'>
							<!-- Â∑¶‰æßÂ∑•ÂÖ∑ÁªÑ -->
							<div class='toolbar-group-left'>
								<button type='button' id='insert-tag-btn' class='icon-btn' title='Insert tag (#)'>
									<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'
										fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round'
										stroke-linejoin='round' class='lucide lucide-hash size-5'
										data-darkreader-inline-stroke=''
										style='--darkreader-inline-stroke: currentColor;'>
										<line x1='4' x2='20' y1='9' y2='9'></line>
										<line x1='4' x2='20' y1='15' y2='15'></line>
										<line x1='10' x2='8' y1='3' y2='21'></line>
										<line x1='16' x2='14' y1='3' y2='21'></line>
									</svg>
								</button>
								<div id='tag-dropdown' class='tag-dropdown-container'>
									<input type='text' id='tag-search-input' placeholder='Search or select tag...'>
									<ul id='tag-dropdown-list'></ul>
								</div>
								<button type='button' id='insert-image-btn' class='icon-btn' title='Insert image'>
									<svg xmlns='http://www.w3.org/2000/svg' height='20px' viewBox='0 0 24 24'
										width='20px' fill='currentColor'>
										<path d='M0 0h24v24H0V0z' fill='none' />
										<path
											d='M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z' />
									</svg>
								</button>
								<!--							<button type='button' id='insert-code-btn' class='icon-btn' title='Insert code'>-->
								<!--								<svg xmlns='http://www.w3.org/2000/svg' height='20px' viewBox='0 0 24 24' width='20px'-->
								<!--										 fill='currentColor'>-->
								<!--									<path d='M0 0h24v24H0V0z' fill='none' />-->
								<!--									<path-->
								<!--										d='M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z' />-->
								<!--								</svg>-->
								<!--							</button>-->
								<button type='button' id='select-files-btn' class='icon-btn' title='Select files'>
									<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
										<path
											d='M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z'>
										</path>
									</svg>
								</button>
								<input type='file' id='note-file' multiple style='display:none;'>

							</div>
							<!-- Âè≥‰æßÂ∑•ÂÖ∑ÁªÑ -->
							<div class='toolbar-group-right'>
								<select id='note-visibility-select' class='visibility-select' title='Visibility'>
									<option value='private'>Private</option>
									<option value='users'>Users</option>
									<option value='public'>Public</option>
								</select>
								<button type='button' id='enter-fullscreen-btn' class='icon-btn'
									title='Fullscreen Editor'>
									<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'>
										<path
											d='M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z'>
										</path>
									</svg>
								</button>
								<button type='button' id='main-preview-toggle-btn' class='icon-btn'
									title='Toggle Preview'>
									<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'
										stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round'
										stroke-linejoin='round'>
										<path stroke='none' d='M0 0h24v24H0z' fill='none' />
										<circle cx='12' cy='12' r='2' />
										<path
											d='M22 12c-2.667 4.667 -6 7 -10 7s-7.333 -2.333 -10 -7c2.667 -4.667 6 -7 10 -7s7.333 2.333 10 7' />
									</svg>
								</button>
								<button type='button' id='main-split-toggle-btn' class='icon-btn'
									title='Toggle Split View'>
									<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24'
										width='24px' fill='currentColor'>
										<path d='M0 0h24v24H0V0z' fill='none' />
										<path
											d='M3 15h8v-2H3v2zm0 4h8v-2H3v2zm0-8h8V9H3v2zm0-6v2h8V5H3zm10 0h8v14h-8V5z' />
									</svg>
								</button>
								<button type='submit' id='submit-btn' style='margin-left: 8px'>Save</button>
							</div>
						</div>
						<div id='file-list-display' class='file-list-display'></div>
					</form>

					<div id='notes-section'>
						<div id='refresh-loader' class='loading-indicator' style='display: none;'>
							<div class='spinner'></div>
						</div>
						<div id='notes-container'></div>
					</div>
					<div id='scroll-loader' class='loading-indicator' style='display: none;'>Loading more...</div>
				</div>

				<!-- ÈôÑ‰ª∂ÊµèËßàÈ°µÈù¢ÂÆπÂô® -->
				<div id="attachments-viewer" style="display: none;">
					<header class="attachments-header">
						<h3>Files</h3>
						<div class="attachments-tabs">
							<button class="tab-btn active" data-filter="all">‚ú® All</button>
							<button class="tab-btn" data-filter="image">üèûÔ∏è Images</button>
							<button class="tab-btn" data-filter="video">üé¨ Videos</button>
							<button class="tab-btn" data-filter="file">üìÑ Files</button>
						</div>
					</header>
					<div id="attachments-content" class="loading-state">
						<div class="spinner"></div>
					</div>
				</div>

			</div>
		</main>

		<aside id='right-sidebar'>
			<div class='sidebar-buttons-group'>
				<button id='home-tab-btn' class='sidebar-tab-btn active' data-tab-name='home' title='Home'>
					<svg xmlns='http://www.w3.org/2000/svg' height='28px' viewBox='0 0 24 24' width='28px'
						fill='currentColor'>
						<path d='M0 0h24v24H0V0z' fill='none' />
						<path d='M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z' />
					</svg>
					<span>Home</span>
				</button>
				<button id='favorites-tab-btn' class='sidebar-tab-btn' data-tab-name='favorites' title='Favorites'>
					<svg xmlns='http://www.w3.org/2000/svg' height='28px' viewBox='0 0 24 24' width='28px'
						fill='currentColor'>
						<path d='M0 0h24v24H0V0z' fill='none' />
						<path
							d='M12 17.27l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.51z' />
					</svg>
					<span>Favorites</span>
				</button>
				<button id="archive-tab-btn" class="sidebar-tab-btn" data-tab-name="archive" title="Archive">
					<svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px"
						fill="currentColor">
						<path d="M0 0h24v24H0V0z" fill="none" />
						<path
							d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM6.24 5h11.52l.83 1H5.41l.83-1zM5 19V8h14v11H5zm11-5.5l-4 4-4-4 1.41-1.41L11 13.67V10h2v3.67l1.59-1.58L16 13.5z" />
					</svg>
					<span>Archive</span>
				</button>
				<button id="attachments-tab-btn" class="sidebar-tab-btn" data-tab-name="attachments"
					title="Attachments">
					<svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px"
						fill="currentColor">
						<path d="M0 0h24v24H0V0z" fill="none" />
						<path
							d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
					</svg>
					<span>Files</span>
				</button>
				<a href="/docs" id="docs-tab-btn" target="_blank" class="sidebar-tab-btn" title="Open Docs">
					<svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px"
						fill="currentColor">
						<path d="M0 0h24v24H0V0z" fill="none" />
						<path
							d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
					</svg>
					<span>Docs</span>
				</a>
			</div>
		</aside>

	</div>

	<div id='theme-color-popover' class='theme-popover'>
		<div class='color-palette'>
		</div>
		<div class='custom-color-separator'></div>
		<div class='custom-color-picker'>
			<label for='color-picker-input' class='color-picker-label' id='color-picker-label'>
				<div id='color-picker-preview' class='color-picker-preview'></div>
				<span>Custom</span>
			</label>
			<input type='color' id='color-picker-input' class='hidden-color-input'>

			<div class='hex-input-wrapper'>
				<input type='text' id='hex-color-input' class='hex-color-input' maxlength='7' placeholder='#367cff'>
			</div>
		</div>
	</div>

	<div id='note-popover-menu' class='popover-menu'>
		<button class='icon-btn' data-action='favorite' title='Favorite'>
			<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='currentColor'>
				<path d='M0 0h24v24H0V0z' fill='none' />
				<path
					d='M12 17.27l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.51z' />
			</svg>
		</button>
		<button class='icon-btn' data-action='pin' title='Pin'>
			<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' stroke-width='2'
				stroke='currentColor' fill='none' stroke-linecap='round' stroke-linejoin='round'>
				<path stroke='none' d='M0 0h24v24H0z' fill='none'></path>
				<path d='M9 4v6l-2 4v2h10v-2l-2 -4v-6'></path>
				<line x1='12' y1='16' x2='12' y2='21'></line>
				<line x1='8' y1='4' x2='16' y2='4'></line>
			</svg>
		</button>
		<button class='icon-btn' data-action='archive' title='Archive'>
			<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor">
				<path d="M0 0h24v24H0V0z" fill="none" />
				<path
					d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L8 13.5l1.41-1.41L11 13.67V10h2v3.67l1.59-1.58L16 13.5l-4 4zM5.12 5l.83-1h12.1l.83 1H5.12z" />
			</svg>
		</button>
		<button class='icon-btn' data-action='share' title='Share'>
			<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor">
				<path d="M0 0h24v24H0V0z" fill="none" />
				<path
					d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z" />
			</svg>
		</button>
		<button class='icon-btn btn-danger' data-action='delete' title='Delete Note'>
			<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='currentColor'>
				<path d='M0 0h24v24H0V0z' fill='none' />
				<path
					d='M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z' />
			</svg>
		</button>
	</div>

	<div id='custom-modal-overlay' class='custom-modal-overlay alert-modal'>
		<!-- Alert Box -->
		<div id='custom-alert-box' class='custom-modal-box'>
			<p id='custom-alert-message'></p>
			<button id='custom-alert-ok-btn' class='btn'>OK</button>
		</div>

		<!-- Confirm Box -->
		<div id='custom-confirm-box' class='custom-modal-box'>
			<p id='custom-confirm-message'></p>
			<div class='custom-modal-actions'>
				<button id='custom-confirm-cancel-btn' class='btn btn-secondary'>Cancel</button>
				<button id='custom-confirm-ok-btn' class='btn btn-danger'>Delete</button>
			</div>
		</div>


		<div id='merge-confirm-box' class='custom-modal-box'>
			<p id='merge-confirm-message'></p>
			<div style="margin: 1rem 0; text-align: left; font-size: 0.9rem;">
				<label style="cursor: pointer; display: flex; align-items: center; justify-content: center;">
					<input type="checkbox" id="merge-add-separator" checked style="margin-right: 0.5rem;">
					Add separator line (---) between notes
				</label>
			</div>
			<div class='custom-modal-actions'>
				<button id='merge-confirm-cancel-btn' class='btn btn-secondary'>Cancel</button>
				<button id='merge-confirm-ok-btn' class='btn btn-primary'>Merge</button>
			</div>
		</div>
	</div>
	<!-- ÂõæÁâáÈ¢ÑËßàÊ®°ÊÄÅÊ°Ü -->
	<div id='image-preview-modal' class='image-preview-modal'>
		<span class='image-preview-close'>&times;</span>
		<img class='image-preview-content' id='modal-image'>
		<div id='image-preview-caption'></div>
	</div>
	<div id='video-preview-modal' class='image-preview-modal'>
		<span class='video-preview-close'>&times;</span>
		<video class='image-preview-content' id='modal-video' controls autoplay muted></video>
		<div id='video-preview-caption'></div>
	</div>

	<!-- ÂÖ®Â±èÁºñËæëÊ®°ÊÄÅÊ°Ü -->
	<div id='fullscreen-editor-overlay' class='custom-modal-overlay'>
		<div id='fullscreen-editor-box' class='custom-modal-box'>
			<header id='editor-toolbar'>
				<div class='toolbar-left'>
					<select id='fs-fontsize-selector' class='toolbar-selector toolbar-btn' title='Font Size'>
						<option value=''>Size</option>
						<option style='font-size: 12px;' value='12px'>12</option>
						<option style='font-size: 14px;' value='14px'>14</option>
						<option style='font-size: 16px;' value='16px'>16</option>
						<option style='font-size: 18px;' value='18px'>18</option>
						<option style='font-size: 20px;' value='20px'>20</option>
						<option style='font-size: 24px;' value='24px'>24</option>
						<option style='font-size: 28px;' value='28px'>28</option>
						<option style='font-size: 36px;' value='36px'>36</option>
					</select>

					<div id='fs-color-picker-wrapper' style='position: relative;'>
						<button id='fs-fontcolor-btn' class='toolbar-btn' title='Font Color'>
							<span
								style='display: inline-block; width: 1em; height: 1em; border: 1px solid transparent; background-color: var(--fs-editor-color, #333); border-radius: 3px; vertical-align: middle;'></span>
						</button>
						<div id='fs-color-popover' class='theme-popover'>
							<div class='color-palette fscolor-palette'>
							</div>
						</div>
					</div>
					<button class='toolbar-btn' data-md='bold' title='Bold (Ctrl+B)'><b>B</b></button>
					<button class="toolbar-btn" data-md="underline" title="Underline"><u>U</u></button>
					<button class='toolbar-btn' data-md='italic' title='Italic (Ctrl+I)'><i>I</i></button>
					<button class='toolbar-btn' data-md='strike' title='Strikethrough'><s>S</s></button>
					<button class='toolbar-btn' data-md='link' title='Insert Link (Ctrl+K)'>Link</button>
					<button class='toolbar-btn' data-md='image' title='Insert Image'>Img</button>
					<button class='toolbar-btn' data-md='blockquote' title='Blockquote'>>_</button>
					<button class="toolbar-btn" data-md="ulist" title="Unordered List">
						<svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
							fill="currentColor">
							<path d="M0 0h24v24H0V0z" fill="none" />
							<path
								d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6s-.67-1.5-1.5-1.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z" />
						</svg>
					</button>
					<button class='toolbar-btn' data-md='code' title='Insert Code Block'>Code</button>
				</div>
				<div class='toolbar-right'>
					<select id="fs-visibility-select" class="visibility-select" title="Visibility"
						style="margin-right:8px;">
						<option value="private">Private</option>
						<option value="users">Users</option>
						<option value="public">Public</option>
					</select>
					<label class="timestamp-toggle-label" id="fs-timestamp-label"
						title="If unchecked, the note's timestamp will be updated upon saving.">
						<input type="checkbox" id="fs-update-timestamp-toggle">
						<span>Keep Time</span>
					</label>
					<button id='view-mode-split-btn' class='icon-btn' title='Split View'>
						<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px'
							fill='currentColor'>
							<path d='M0 0h24v24H0V0z' fill='none' />
							<path d='M3 15h8v-2H3v2zm0 4h8v-2H3v2zm0-8h8V9H3v2zm0-6v2h8V5H3zm10 0h8v14h-8V5z' />
						</svg>
					</button>
					<button id='view-mode-preview-btn' class='icon-btn' title='Preview'>
						<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'
							stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round'
							stroke-linejoin='round'>
							<path stroke='none' d='M0 0h24v24H0z' fill='none' />
							<circle cx='12' cy='12' r='2' />
							<path
								d='M22 12c-2.667 4.667 -6 7 -10 7s-7.333 -2.333 -10 -7c2.667 -4.667 6 -7 10 -7s7.333 2.333 10 7' />
						</svg>
					</button>

					<button id='fs-save-btn' class='btn btn-primary'>Save</button>
					<button id='fs-cancel-btn' class='btn btn-secondary'>Cancel</button>
				</div>
			</header>
			<div id='editor-content-area'>
				<textarea id='fs-editor-textarea'></textarea>
				<!-- --- ÂèØÊãñÊãΩÁöÑÂàÜÂâ≤Êù° --- -->
				<div id='fs-editor-divider'></div>
				<div id='fs-preview-pane' class='note-content'></div>
			</div>
		</div>
	</div>

	<!-- ËøîÂõûÈ°∂ÈÉ® -->
	<button id='back-to-top-btn' title='Back to top'>
		<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='#FFFFFF'>
			<path d='M0 0h24v24H0V0z' fill='none' />
			<path d='M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z' />
		</svg>
	</button>


	<div id='settings-modal-overlay' class='custom-modal-overlay'>
		<div id='settings-modal-box' class='custom-modal-box'>
			<header class='settings-header'>
				<h3>Settings</h3>
				<button id='close-settings-btn' class='icon-btn'>&times;</button>
			</header>
			<div class='settings-content'>
				<div class='setting-group'>
					<h4 id='settings-language-title'>Language</h4>
					<div class='setting-item'>
						<div class='setting-item-text'>
							<label for='settings-language-select' id='settings-language-label'>Interface Language</label>
						</div>
						<select id='settings-language-select' class='language-select'>
							<option value='zh'>‰∏≠Êñá</option>
							<option value='en'>English</option>
							<option value='system'>Follow system</option>
						</select>
					</div>
				</div>
				<div class='setting-group'>
					<h4>Interface Visibility</h4>
					<div class='setting-item'>
						<label for='toggle-search-bar'>Show Search</label>
						<input type='checkbox' id='toggle-search-bar' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-stats-card'>Show Stats</label>
						<input type='checkbox' id='toggle-stats-card' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-calendar'>Show Calendar</label>
						<input type='checkbox' id='toggle-calendar' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-heatmap'>Show Heatmap</label>
						<input type='checkbox' id='toggle-heatmap' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-tags'>Show Tags</label>
						<input type='checkbox' id='toggle-tags' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-timeline'>Show Timeline</label>
						<input type='checkbox' id='toggle-timeline' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-right-sidebar'>Show Right Sidebar</label>
						<input type='checkbox' id='toggle-right-sidebar' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-date-grouping'>Enable Date Grouping</label>
						<input type='checkbox' id='toggle-date-grouping' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-content-truncation'>Enable Content Truncation</label>
						<input type='checkbox' id='toggle-content-truncation' class='toggle-switch'>
					</div>
				</div>


				<div class='setting-group'>
					<h4>Feature Visibility</h4>
					<div class='setting-item'>
						<label for='toggle-feature-favorites'>Show Favorites</label>
						<input type='checkbox' id='toggle-feature-favorites' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-feature-archive'>Show Archive</label>
						<input type='checkbox' id='toggle-feature-archive' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-feature-pinning'>Enable Pinning</label>
						<input type='checkbox' id='toggle-feature-pinning' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-feature-sharing'>Enable Sharing</label>
						<input type='checkbox' id='toggle-feature-sharing' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='toggle-feature-docs'>Show Docs Link</label>
						<input type='checkbox' id='toggle-feature-docs' class='toggle-switch'>
					</div>
				</div>

				<div class='setting-group' id='user-management-section' style='display:none;'>
					<h4>User Management (Admin)</h4>
					<form id='create-user-form' class='setting-item user-admin-form'>
						<div class='user-admin-subtitle'>Create User</div>
						<div class='user-admin-field'>
							<label for='new-username'>Username</label>
							<input type='text' id='new-username' class='user-input' placeholder='Username' required>
						</div>
						<div class='user-admin-field'>
							<label for='new-password'>Password</label>
							<input type='password' id='new-password' class='user-input' placeholder='Password' required>
						</div>
						<div class='user-admin-field'>
							<label for='new-telegram-id'>Telegram User ID (optional)</label>
							<input type='text' id='new-telegram-id' class='user-input'
								placeholder='Telegram User ID (optional)'>
						</div>
						<div class='user-admin-inline'>
							<label class='user-admin-checkbox' for='new-is-admin'>
								<input type='checkbox' id='new-is-admin' aria-label='Admin'>
								<span>Admin</span>
							</label>
							<div class='user-admin-actions'>
								<button type='submit' class='btn btn-secondary btn-sm'>Create User</button>
							</div>
						</div>
					</form>
					<div class='setting-item user-table-block'>
						<div class='user-admin-subtitle'>User List</div>
						<div class='user-table-wrapper'>
							<table id='user-table' class='user-table' aria-label='User list'>
								<thead>
									<tr>
										<th class='username-col'>Username</th>
										<th class='admin-col'>Admin</th>
										<th class='telegram-col'>Telegram</th>
										<th class='created-col'>Created</th>
										<th class='actions-col'>Actions</th>
									</tr>
								</thead>
								<tbody id='user-table-body'></tbody>
							</table>
						</div>
					</div>
				</div>

				<div class='setting-group'>
					<h4>Background</h4>
					<div class='setting-item'>
						<label for='bg-image-url'>Image URL</label>
						<input type='text' id='bg-image-url' placeholder='Enter image URL...'>
					</div>
					<div class='setting-item'>
						<label for='bg-image-upload'>Or Upload</label>
						<input type='file' id='bg-image-upload' accept='image/*'>
					</div>
					<div class='setting-item'>
						<label for='bg-blur-slider'>Glass Effect</label>
						<input type='range' id='bg-blur-slider' min='0' max='20' value='0'>
					</div>
					<div class='setting-item'>
						<label for='bg-opacity-slider'>Background Opacity</label>
						<input type='range' id='bg-opacity-slider' min='0' max='1' step='0.05' value='1'>
					</div>
					<div class='setting-item'>
						<label></label>
						<div class='setting-buttons-group'>
							<button id='restore-bg-btn' class='btn btn-secondary btn-sm'>Restore</button>
							<button id='clear-bg-btn' class='btn btn-secondary btn-sm'>Clear</button>
						</div>
					</div>
				</div>

				<div class='setting-group'>
					<h4>Surface</h4>
					<div class='setting-item'>
						<label for='surface-color-picker-input'>Base Color</label>
						<div style="display: flex; align-items: center; gap: 0.75rem; position: relative;">
							<label for='surface-color-picker-input' class='color-picker-label'
								id='surface-color-picker-label' title="Click to open color picker"
								style="cursor: pointer;">
								<div id='surface-color-picker-preview' class='color-picker-preview'></div>
							</label>
							<input type='color' id='surface-color-picker-input' class='hidden-color-input'>
							<div class='hex-input-wrapper'>
								<input type='text' id='surface-hex-color-input' class='hex-color-input' maxlength='7'
									placeholder='#151f31'>
							</div>
						</div>
					</div>
					<div class='setting-item'>
						<label for='surface-opacity-slider'>Opacity</label>
						<input type='range' id='surface-opacity-slider' min='0' max='1' step='0.05' value='1'>
					</div>
					<div class='setting-item'>
						<label></label>
						<div class='setting-buttons-group'>
							<button id='restore-surface-defaults-btn' class='btn btn-secondary btn-sm'>Restore
								Defaults</button>
						</div>
					</div>
				</div>

				<div class='setting-group'>
					<h4>Image Paste Upload</h4>
					<div id='image-upload-options'>
						<div class='setting-item'>
							<label for='upload-dest-local'>
								<input type='radio' id='upload-dest-local' name='upload-destination' value='local'
									checked>
								Local (via Worker & R2)
							</label>
						</div>
						<div class='setting-item'>
							<label for='upload-dest-imgur'>
								<input type='radio' id='upload-dest-imgur' name='upload-destination' value='imgur'>
								ImgurÔºàÈúÄË¶Å Client IDÔºâ
							</label>
						</div>
					</div>
					<div class='setting-item' id='imgur-client-id-wrapper' style='display: flex;'>
						<label for='imgur-client-id'>Imgur Client ID</label>
						<input type='text' id='imgur-client-id' placeholder='ËæìÂÖ• Imgur Client ID...'>
					</div>
				</div>
				<div class='setting-group'>
					<h4>Telegram Proxy</h4>
					<div class='setting-item'>
						<label for='toggle-telegram-proxy'>Enable Video&File Proxy</label>
						<input type='checkbox' id='toggle-telegram-proxy' class='toggle-switch'>
					</div>
				</div>

				<div class='setting-group'>
					<h4>Waterfall Mode</h4>
					<div class='setting-item'>
						<label for='toggle-editor-in-waterfall'>Hide Editor in Waterfall Mode</label>
						<input type='checkbox' id='toggle-editor-in-waterfall' class='toggle-switch'>
					</div>
					<div class='setting-item'>
						<label for='waterfall-width-slider'>Card Width (px)</label>
						<input type='range' id='waterfall-width-slider' min='200' max='600' step='10' value='320'>
						<span id='waterfall-width-value'>320px</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--<div id='waterfall-popover-menu' class='popover-menu'>
	<button class='icon-btn' data-action='view' title='View Note'>
		<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='currentColor'>
			<path d='M0 0h24v24H0V0z' fill='none' />
			<path
				d='M12 6.5c3.79 0 7.17 2.13 8.82 5.5-1.65 3.37-5.02 5.5-8.82 5.5S4.83 15.37 3.18 12C4.83 8.63 8.21 6.5 12 6.5m0-2C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 7.61 17 4.5 12 4.5zm0 5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5m0-2c-2.48 0-4.5 2.02-4.5 4.5s2.02 4.5 4.5 4.5 4.5-2.02 4.5-4.5-2.02-4.5-4.5-4.5z' />
		</svg>
	</button>
	<button class='icon-btn btn-danger' data-action='delete' title='Delete Note'>
		<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='currentColor'>
			<path d='M0 0h24v24H0V0z' fill='none' />
			<path d='M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z' />
		</svg>
	</button>
</div>-->

	<div id='heatmap-tooltip'></div>
	<div id='calendar-tooltip'></div>
	<div id="toast-notification"></div>

	<!-- Share Link Modal -->
	<div id='share-link-modal-overlay' class='custom-modal-overlay'>
		<div id='share-link-modal-box' class='custom-modal-box' style="max-width: 600px; text-align: left;">
			<h3 style="margin-top:0;">Share Memo</h3>
			<div id="share-link-content">
				<!-- Âä†ËΩΩÁä∂ÊÄÅ -->
				<div id="share-link-loader" style="text-align: center; padding: 2rem 0;">
					<div class="spinner"></div>
					<p>Generating link...</p>
				</div>
				<!-- ÈìæÊé•ÂÜÖÂÆπ -->
				<div id="share-link-details" style="display: none;">
					<p>Anyone with these public links can view this memo.</p>
					<div class="share-link-item" style="margin-bottom: 1rem;">
						<label style="font-weight: 500;">Display Link</label>
						<div style="display: flex; gap: 0.5rem;">
							<input type="text" id="share-display-link-input" readonly
								style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--bg-color);">
							<button id="copy-display-link-btn" class="btn">Copy</button>
						</div>
					</div>
					<div class="share-link-item" style="margin-bottom: 1.5rem;">
						<label style="font-weight: 500;">Raw Content Link</label>
						<div style="display: flex; gap: 0.5rem;">
							<input type="text" id="share-raw-link-input" readonly
								style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--bg-color);">
							<button id="copy-raw-link-btn" class="btn">Copy</button>
						</div>
					</div>

					<div class="share-link-item" style="display: flex; align-items: center; gap: 1rem;">
						<label for="expiration-select" style="font-weight: 500; flex-shrink: 0;">Expires in:</label>
						<select id="expiration-select"
							style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--bg-color); color: var(--text-color);">
							<option value="3600">1 Hour</option>
							<option value="14400">4 Hour</option>
							<option value="43200">12 Hours</option>
							<option value="86400">1 Day</option>
							<option value="604800">7 Days</option>
							<option value="0">Never</option>
							<option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
							<option value="revoke">Revoke Now (Expire Immediately)</option>
						</select>
						<span id="expiration-status"
							style="font-size: 0.8rem; color: var(--text-secondary); width: 80px; text-align: right;"></span>
					</div>
				</div>
			</div>
			<div class='custom-modal-actions' style="justify-content: flex-end;">
				<button id='share-link-close-btn' class='btn btn-secondary'>Close</button>
			</div>
		</div>
	</div>

	<div id="note-ghost-element"></div>
    <script type="module" src="/js/app.js"></script>
</body>

</html>
